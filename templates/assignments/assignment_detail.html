{% extends "base.html" %}
{% block content %}

<div class="dashboard">

    <!-- Header -->
    <div class="card" style="position: relative;">

        <!-- Back button (top-right) -->
        <button class="btn btn-back" onclick="history.back()" style="position:absolute; top:20px; right:20px;">
            ← Back
        </button>

        <h1 style="margin-bottom: 0.4rem;">
            {{ assignment.title }}
        </h1>

        <p class="muted">
            Course: <strong>{{ assignment.course.title }}</strong>
        </p>

        <hr />

        <p>{{ assignment.description }}</p>
    </div>

    <!-- ================= STUDENT VIEW ================= -->
    {% if request.user.profile.role == request.user.profile.Role.STUDENT %}
    <div class="card">

        <h2>Your Submission</h2>

        {% if submission %}
        <div class="assignment-block">

            <p class="muted">
                Submitted on {{ submission.submitted_at|date:"M d, Y · H:i" }}
            </p>

            {% if submission.file %}
            <p>
                <a href="{{ submission.file.url }}" class="assignment-link">
                    Download submitted file
                </a>
            </p>
            {% endif %}

            {% if submission.feedback %}
            <hr />
            <p><strong>Instructor feedback</strong></p>
            <p>{{ submission.feedback }}</p>
            {% endif %}

            {% if submission.grade is not None %}
            <p>
                <strong>Grade:</strong>
                <span class="badge badge-green">{{ submission.grade }}</span>
            </p>
            {% endif %}
        </div>

        {% else %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <br>

            <button type="submit">
                Submit assignment
            </button>
        </form>
        {% endif %}
    </div>
    {% endif %}

    <!-- ================= INSTRUCTOR VIEW ================= -->
    {% if request.user.profile.role == request.user.profile.Role.INSTRUCTOR %}
    <div class="card">
        <a href="{% url 'instructor_assignment_detail' assignment.id %}" class="btn">
            Open instructor panel
        </a>
    </div>
    {% endif %}

</div>

{% endblock %}